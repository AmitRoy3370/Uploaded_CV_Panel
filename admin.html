<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<h1>Uploaded CVs</h1>
<table id="cv-list">
    <thead>
    <tr>
        <th>Id</th>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Download</th>
        <th>CreatedAt</th>
        <th>Delete</th>
    </tr>
    </thead>
    <tbody>

    </tbody>
</table>

<script>
    fetch('/admin')
        .then(response => response.json())
        .then(data => {
            const cvList = document.getElementById('cv-list').getElementsByTagName('tbody')[0];
            data.forEach(cv => {

                const row = cvList.insertRow();
                const id = row.insertCell(0);
                const nameCell = row.insertCell(1);
                const emailCell = row.insertCell(2);
                const phoneCell = row.insertCell(3);
                const downloadCell = row.insertCell(4);
                const createAtCell = row.insertCell(5);
                const actionsCell = row.insertCell(6);

                nameCell.textContent = cv.name;
                emailCell.textContent = cv.email;

                createAtCell.textContent = cv.created_at;
                id.textContent = cv.id;
                phoneCell.textContent = cv.phone;

                const downloadLink = document.createElement('a');
                downloadLink.href = `/download/${cv.id}`;
                downloadLink.textContent = 'Download';
                downloadCell.appendChild(downloadLink);

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.onclick = function() {
                    if (confirm('Are you sure you want to delete this CV?')) {
                        fetch(`/admin/delete/${cv.id}`, {
                            method: 'DELETE',
                        })
                            .then(response => {
                                if (response.ok) {
                                    alert('File deleted successfully!');
                                    row.remove();
                                } else {
                                    alert('Error deleting file.');
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                            });
                    }
                };
                actionsCell.appendChild(deleteButton);

            });
        })
        .catch(error => {
            console.error('Error fetching CVs:', error);
        });
</script>
</body>
</html>
